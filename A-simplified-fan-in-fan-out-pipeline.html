
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Golang Concurrency Pattern: Simplified Fan-in Fan-out Pipeline - Dasar Pemrograman Golang</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta  name="google-site-verification"  content="UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE" >
    
    <meta  name="og:image"  content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg" >
    
    <meta  name="twitter:image"  content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg" >
    
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="A-pipeline-context-cancellation.html" />
    
    
    <link rel="prev" href="A-concurrency-pipeline.html" />
    


    <link rel="stylesheet" href="/adjustment.css?v=2.2020.05.17.120620"><script async defer src="https://buttons.github.io/buttons.js"></script><script>!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');fbq('init','1247398778924723');fbq('track','PageView');</script><noscript><imgheight="1"width="1"style="display:none"src="https://www.facebook.com/tr?id=1247398778924723&ev=PageView&noscript=1"/></noscript></head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Dasar Pemrograman Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="CONTRIBUTORS.html">
            
                <a href="CONTRIBUTORS.html">
            
                    
                    Kontributor
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <span>
            
                    
                    A. Pemrograman Go Dasar
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="1-berkenalan-dengan-golang.html">
            
                <a href="1-berkenalan-dengan-golang.html">
            
                    
                    A.1. Belajar Golang (Perkenalan)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="2-instalasi-golang.html">
            
                <a href="2-instalasi-golang.html">
            
                    
                    A.2. Instalasi Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" >
            
                <span>
            
                    
                    A.3. Setup Project dan GOPATH
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.3.1" data-path="3-setup-go-project-dengan-go-modules.html">
            
                <a href="3-setup-go-project-dengan-go-modules.html">
            
                    
                    A.3.A. Go Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3.2" data-path="3-gopath-dan-workspace.html">
            
                <a href="3-gopath-dan-workspace.html">
            
                    
                    A.3.B. GOPATH Dan Workspace
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="4-instalasi-editor.html">
            
                <a href="4-instalasi-editor.html">
            
                    
                    A.4. Instalasi Editor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="5-go-command.html">
            
                <a href="5-go-command.html">
            
                    
                    A.5. Go Command
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.6" data-path="6-hello-world.html">
            
                <a href="6-hello-world.html">
            
                    
                    A.6. Program Pertama: Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7" data-path="7-komentar.html">
            
                <a href="7-komentar.html">
            
                    
                    A.7. Komentar
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.8" data-path="8-variabel.html">
            
                <a href="8-variabel.html">
            
                    
                    A.8. Variabel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.9" data-path="9-tipe-data.html">
            
                <a href="9-tipe-data.html">
            
                    
                    A.9. Tipe Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.10" data-path="10-konstanta.html">
            
                <a href="10-konstanta.html">
            
                    
                    A.10. Konstanta
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.11" data-path="11-operator.html">
            
                <a href="11-operator.html">
            
                    
                    A.11. Operator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.12" data-path="12-seleksi-kondisi.html">
            
                <a href="12-seleksi-kondisi.html">
            
                    
                    A.12. Seleksi Kondisi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.13" data-path="13-perulangan.html">
            
                <a href="13-perulangan.html">
            
                    
                    A.13. Perulangan
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.14" data-path="14-array.html">
            
                <a href="14-array.html">
            
                    
                    A.14. Array
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.15" data-path="15-slice.html">
            
                <a href="15-slice.html">
            
                    
                    A.15. Slice
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.16" data-path="16-map.html">
            
                <a href="16-map.html">
            
                    
                    A.16. Map
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.17" data-path="17-fungsi.html">
            
                <a href="17-fungsi.html">
            
                    
                    A.17. Fungsi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.18" data-path="18-fungsi-multiple-return.html">
            
                <a href="18-fungsi-multiple-return.html">
            
                    
                    A.18. Fungsi Multiple Return
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.19" data-path="19-fungsi-variadic.html">
            
                <a href="19-fungsi-variadic.html">
            
                    
                    A.19. Fungsi Variadic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.20" data-path="20-fungsi-closure.html">
            
                <a href="20-fungsi-closure.html">
            
                    
                    A.20. Fungsi Closure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.21" data-path="21-fungsi-sebagai-parameter.html">
            
                <a href="21-fungsi-sebagai-parameter.html">
            
                    
                    A.21. Fungsi Sebagai parameter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.22" data-path="22-pointer.html">
            
                <a href="22-pointer.html">
            
                    
                    A.22. Pointer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.23" data-path="23-struct.html">
            
                <a href="23-struct.html">
            
                    
                    A.23. Struct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.24" data-path="24-method.html">
            
                <a href="24-method.html">
            
                    
                    A.24. Method
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.25" data-path="25-properti-public-dan-private.html">
            
                <a href="25-properti-public-dan-private.html">
            
                    
                    A.25. Properti Public dan Private (Exported vs Unexported)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.26" data-path="26-interface.html">
            
                <a href="26-interface.html">
            
                    
                    A.26. Interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.27" data-path="27-interface-kosong.html">
            
                <a href="27-interface-kosong.html">
            
                    
                    A.27. Interface Kosong
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.28" data-path="28-reflect.html">
            
                <a href="28-reflect.html">
            
                    
                    A.28. Reflect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.29" data-path="29-goroutine.html">
            
                <a href="29-goroutine.html">
            
                    
                    A.29. Goroutine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.30" data-path="30-channel.html">
            
                <a href="30-channel.html">
            
                    
                    A.30. Channel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.31" data-path="31-buffered-channel.html">
            
                <a href="31-buffered-channel.html">
            
                    
                    A.31. Buffered Channel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.32" data-path="32-channel-select.html">
            
                <a href="32-channel-select.html">
            
                    
                    A.32. Channel - Select
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.33" data-path="33-channel-range-close.html">
            
                <a href="33-channel-range-close.html">
            
                    
                    A.33. Channel - Range & Close
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.34" data-path="34-channel-timeout.html">
            
                <a href="34-channel-timeout.html">
            
                    
                    A.34. Channel - Timeout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.35" data-path="35-defer-exit.html">
            
                <a href="35-defer-exit.html">
            
                    
                    A.35. Defer & Exit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.36" data-path="36-error-panic-recover.html">
            
                <a href="36-error-panic-recover.html">
            
                    
                    A.36. Error, Panic, & Recover
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.37" data-path="37-string-format.html">
            
                <a href="37-string-format.html">
            
                    
                    A.37. Layout Format String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.38" data-path="38-time.html">
            
                <a href="38-time.html">
            
                    
                    A.38. Time, Parsing Time, & Format Time
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.39" data-path="39-timer.html">
            
                <a href="39-timer.html">
            
                    
                    A.39. Timer, Ticker, & Scheduler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.40" data-path="40-data-type-conversion.html">
            
                <a href="40-data-type-conversion.html">
            
                    
                    A.40. Konversi Antar Tipe Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.41" data-path="41-strings.html">
            
                <a href="41-strings.html">
            
                    
                    A.41. Fungsi String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.42" data-path="42-regex.html">
            
                <a href="42-regex.html">
            
                    
                    A.42. Regex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.43" data-path="43-encoding-base64.html">
            
                <a href="43-encoding-base64.html">
            
                    
                    A.43. Encode - Decode Base64
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.44" data-path="44-hash-sha1.html">
            
                <a href="44-hash-sha1.html">
            
                    
                    A.44. Hash Sha1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.45" data-path="45-command-line-args-flag.html">
            
                <a href="45-command-line-args-flag.html">
            
                    
                    A.45. Arguments & Flag
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.46" data-path="46-exec.html">
            
                <a href="46-exec.html">
            
                    
                    A.46. Exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.47" data-path="47-file.html">
            
                <a href="47-file.html">
            
                    
                    A.47. File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.48" data-path="48-web.html">
            
                <a href="48-web.html">
            
                    
                    A.48. Web
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.49" data-path="49-url-parsing.html">
            
                <a href="49-url-parsing.html">
            
                    
                    A.49. URL Parsing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.50" data-path="50-json.html">
            
                <a href="50-json.html">
            
                    
                    A.50. JSON
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.51" data-path="51-web-json-api.html">
            
                <a href="51-web-json-api.html">
            
                    
                    A.51. Web Service API (JSON Data)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.52" data-path="52-http-request.html">
            
                <a href="52-http-request.html">
            
                    
                    A.52. HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.53" data-path="53-sql.html">
            
                <a href="53-sql.html">
            
                    
                    A.53. SQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.54" data-path="54-mongodb.html">
            
                <a href="54-mongodb.html">
            
                    
                    A.54. NoSQL MongoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.55" data-path="55-unit-test.html">
            
                <a href="55-unit-test.html">
            
                    
                    A.55. Unit Test
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.56" data-path="56-waitgroup.html">
            
                <a href="56-waitgroup.html">
            
                    
                    A.56. sync.WaitGroup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.57" data-path="57-mutex.html">
            
                <a href="57-mutex.html">
            
                    
                    A.57. sync.Mutex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.58" data-path="A-go-vendoring.html">
            
                <a href="A-go-vendoring.html">
            
                    
                    A.58. Go Vendoring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.59" data-path="A-concurrency-pipeline.html">
            
                <a href="A-concurrency-pipeline.html">
            
                    
                    A.59. Concurrency Pattern: Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.1.60" data-path="A-simplified-fan-in-fan-out-pipeline.html">
            
                <a href="A-simplified-fan-in-fan-out-pipeline.html">
            
                    
                    A.60. Concurrency Pattern: Simplified Fan-in Fan-out Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.61" data-path="A-pipeline-context-cancellation.html">
            
                <a href="A-pipeline-context-cancellation.html">
            
                    
                    A.61. Concurrency Pattern: Context Cancellation Pipeline
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <span>
            
                    
                    B. Pemrograman Web Go Dasar
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="B-1-golang-web-hello-world.html">
            
                <a href="B-1-golang-web-hello-world.html">
            
                    
                    B.1. Golang Web App: Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="B-2-routing-http-handlefunc.html">
            
                <a href="B-2-routing-http-handlefunc.html">
            
                    
                    B.2. Routing http.HandleFunc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="B-3-routing-static-assets.html">
            
                <a href="B-3-routing-static-assets.html">
            
                    
                    B.3. Routing Static Assets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="B-4-template-render-html.html">
            
                <a href="B-4-template-render-html.html">
            
                    
                    B.4. Template: Render HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="B-5-template-render-partial-html.html">
            
                <a href="B-5-template-render-partial-html.html">
            
                    
                    B.5. Template: Render Partial HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="B-6-template-actions-variables.html">
            
                <a href="B-6-template-actions-variables.html">
            
                    
                    B.6. Template: Actions & Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7" data-path="B-7-template-functions.html">
            
                <a href="B-7-template-functions.html">
            
                    
                    B.7. Template: Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8" data-path="B-8-template-custom-functions.html">
            
                <a href="B-8-template-custom-functions.html">
            
                    
                    B.8. Template: Custom Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.9" data-path="B-9-render-specific-html-template.html">
            
                <a href="B-9-render-specific-html-template.html">
            
                    
                    B.9. Template: Render Specific HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.10" data-path="B-10-render-html-string.html">
            
                <a href="B-10-render-html-string.html">
            
                    
                    B.10. Template: Render HTML String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.11" data-path="B-11-http-method.html">
            
                <a href="B-11-http-method.html">
            
                    
                    B.11. HTTP Method: POST & GET
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.12" data-path="B-12-form-value.html">
            
                <a href="B-12-form-value.html">
            
                    
                    B.12. Form Value
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.13" data-path="B-13-form-upload-file.html">
            
                <a href="B-13-form-upload-file.html">
            
                    
                    B.13. Form Upload File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.14" data-path="B-14-ajax-json-payload.html">
            
                <a href="B-14-ajax-json-payload.html">
            
                    
                    B.14. AJAX JSON Payload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.15" data-path="B-15-ajax-json-response.html">
            
                <a href="B-15-ajax-json-response.html">
            
                    
                    B.15. AJAX JSON Response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.16" data-path="B-16-ajax-multi-upload.html">
            
                <a href="B-16-ajax-multi-upload.html">
            
                    
                    B.16. AJAX Multiple File Upload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.17" data-path="B-17-download-file.html">
            
                <a href="B-17-download-file.html">
            
                    
                    B.17. Download File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.18" data-path="B-18-http-basic-auth.html">
            
                <a href="B-18-http-basic-auth.html">
            
                    
                    B.18. HTTP Basic Auth
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.19" data-path="B-19-middleware-using-http-handler.html">
            
                <a href="B-19-middleware-using-http-handler.html">
            
                    
                    B.19. Middleware http.Handler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.20" data-path="B-20-custom-mux-multiplexer.html">
            
                <a href="B-20-custom-mux-multiplexer.html">
            
                    
                    B.20. Custom Multiplexer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.21" data-path="B-21-cookie.html">
            
                <a href="B-21-cookie.html">
            
                    
                    B.21. HTTP Cookie
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.22" data-path="B-22-simple-configuration.html">
            
                <a href="B-22-simple-configuration.html">
            
                    
                    B.22. Simple Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.23" data-path="B-server-handler-http-request-cancellation.html">
            
                <a href="B-server-handler-http-request-cancellation.html">
            
                    
                    B.23. Server Handler HTTP Request Cancellation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" >
            
                <span>
            
                    
                    C. Pemrograman Go Lanjut
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="C-1-echo-routing.html">
            
                <a href="C-1-echo-routing.html">
            
                    
                    C.1. Echo Framework & Routing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="C-2-parsing-http-request-payload-echo.html">
            
                <a href="C-2-parsing-http-request-payload-echo.html">
            
                    
                    C.2. Parsing HTTP Request Payload (Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="C-3-http-request-payload-validation.html">
            
                <a href="C-3-http-request-payload-validation.html">
            
                    
                    C.3. HTTP Request Payload Validation (Validator v9, Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="C-4-http-error-handling.html">
            
                <a href="C-4-http-error-handling.html">
            
                    
                    C.4. HTTP Error Handling (Validator v9, Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="C-5-echo-template-rendering.html">
            
                <a href="C-5-echo-template-rendering.html">
            
                    
                    C.5. Template Rendering in Echo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6" data-path="C-6-advanced-middleware-and-logging.html">
            
                <a href="C-6-advanced-middleware-and-logging.html">
            
                    
                    C.6. Advanced Middleware & Logging (Logrus, Echo Logger)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7" data-path="C-7-flag-parser.html">
            
                <a href="C-7-flag-parser.html">
            
                    
                    C.7. CLI Flag Parser (Kingpin)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.8" >
            
                <span>
            
                    
                    C.8. Advanced Configuration
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.8.1" data-path="C-8-A-advanced-configuration-viper.html">
            
                <a href="C-8-A-advanced-configuration-viper.html">
            
                    
                    C.8.A. Advanced Configuration: Viper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.8.2" data-path="C-8-B-best-practice-configuration-env-var.html">
            
                <a href="C-8-B-best-practice-configuration-env-var.html">
            
                    
                    C.8.B. Best Practice Configuration: Environment Variable
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.9" data-path="C-9-securecookie.html">
            
                <a href="C-9-securecookie.html">
            
                    
                    C.9. Secure Cookie (Gorilla Securecookie)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.10" data-path="C-10-session.html">
            
                <a href="C-10-session.html">
            
                    
                    C.10. Session (Gorilla Session)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.11" data-path="C-12-cors-preflight-request.html">
            
                <a href="C-12-cors-preflight-request.html">
            
                    
                    C.12. CORS & Preflight Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.12" data-path="C-13-csrf.html">
            
                <a href="C-13-csrf.html">
            
                    
                    C.13. CSRF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.13" data-path="C-14-secure-middleware.html">
            
                <a href="C-14-secure-middleware.html">
            
                    
                    C.14. Secure Middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.14" data-path="C-15-http-gzip-compression.html">
            
                <a href="C-15-http-gzip-compression.html">
            
                    
                    C.15. HTTP Gzip Compression (gziphandler)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.15" data-path="C-16-send-email.html">
            
                <a href="C-16-send-email.html">
            
                    
                    C.16. Send Mail (net/smtp, Gomail v2)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.16" data-path="C-17-read-write-excel-xlsx-file.html">
            
                <a href="C-17-read-write-excel-xlsx-file.html">
            
                    
                    C.17. Read & Write Excel XLSX File (Excelize)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.17" data-path="C-18-write-pdf-file.html">
            
                <a href="C-18-write-pdf-file.html">
            
                    
                    C.18. Write PDF File (gofpdf)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.18" data-path="C-19-convert-html-to-pdf.html">
            
                <a href="C-19-convert-html-to-pdf.html">
            
                    
                    C.19. Convert HTML to PDF (go-wkhtmltopdf)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.19" data-path="C-20-scraping-parsing-html.html">
            
                <a href="C-20-scraping-parsing-html.html">
            
                    
                    C.20. Scraping & Parsing HTML (goquery)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.20" data-path="C-21-xml-parser.html">
            
                <a href="C-21-xml-parser.html">
            
                    
                    C.21. Parse & Generate XML (etree)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.21" data-path="C-22-https-tls.html">
            
                <a href="C-22-https-tls.html">
            
                    
                    C.22. HTTPS/TLS Web Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.22" data-path="C-23-http2-server-push.html">
            
                <a href="C-23-http2-server-push.html">
            
                    
                    C.23. HTTP/2 & HTTP/2 Server Push
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.23" data-path="C-24-client-http-request.html">
            
                <a href="C-24-client-http-request.html">
            
                    
                    C.24. Client HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.24" data-path="C-25-secure-insecure-client-http-request.html">
            
                <a href="C-25-secure-insecure-client-http-request.html">
            
                    
                    C.25. Secure & Insecure Client HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.25" data-path="C-26-golang-ftp.html">
            
                <a href="C-26-golang-ftp.html">
            
                    
                    C.26. FTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.26" data-path="C-27-golang-ssh-sftp.html">
            
                <a href="C-27-golang-ssh-sftp.html">
            
                    
                    C.27. SSH & SFTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.27" data-path="C-29-golang-protobuf-implementation.html">
            
                <a href="C-29-golang-protobuf-implementation.html">
            
                    
                    C.29. Protobuf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.28" data-path="C-30-golang-grpc-protobuf.html">
            
                <a href="C-30-golang-grpc-protobuf.html">
            
                    
                    C.30. gRPC + Protobuf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.29" data-path="C-32-golang-jwt.html">
            
                <a href="C-32-golang-jwt.html">
            
                    
                    C.32. JSON Web Token (JWT)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.30" data-path="C-33-golang-ldap-authentication.html">
            
                <a href="C-33-golang-ldap-authentication.html">
            
                    
                    C.33. LDAP Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.31" data-path="C-34-golang-sso-saml-sp.html">
            
                <a href="C-34-golang-sso-saml-sp.html">
            
                    
                    C.34. SSO SAML (Service Provider)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.32" data-path="C-dockerize-golang.html">
            
                <a href="C-dockerize-golang.html">
            
                    
                    C.35. Dockerize Aplikasi Golang
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1" >
            
                <span>
            
                    
                    D. Studi Kasus
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="D-insert-1mil-csv-record-into-db-in-a-minute.html">
            
                <a href="D-insert-1mil-csv-record-into-db-in-a-minute.html">
            
                    
                    D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="D-google-api-search.html">
            
                <a href="D-google-api-search.html">
            
                    
                    D.2. Google API Search Dengan Timeout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="D-golang-web-socket-chatting-app.html">
            
                <a href="D-golang-web-socket-chatting-app.html">
            
                    
                    D.3. Web Socket: Chatting App
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >A.60. Concurrency Pattern: Simplified Fan-in Fan-out Pipeline</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="a60-concurrency-pattern-simplified-fan-out-fan-in-pipeline">A.60. Concurrency Pattern: Simplified Fan-out Fan-in Pipeline</h1>
<p>Pada chapter sebelumnya, yaitu <a href="A-concurrency-pipeline.html">A.59. Concurrency Pattern: Pipeline</a>, kita telah mempelajari tentang pipeline pattern, yang dimana pattern tersebut merupakan rekomendasi dari tim Go dalam meng-<em>handle</em> jenis kasus sekarangkain proses yang berjalan secara konkuren.</p>
<blockquote>
<p>Penulis sangat anjurkan untuk mencoba mempelajari praktek chapter sebelumnya terlebih dahulu jika belum. Karena chapter kali ini ada hubungannya dengan chapter tersebut.</p>
</blockquote>
<p>Pada chapter ini kita akan mempelajari concurrency pattern juga, lanjutan dari sebelumnya. Pada versi ini kalau dilihat dari prespektif coding penerapannya akan lebih ringkas. Tapi apakah lebih mudah dan lebih <em>performant</em> dibanding penerapan pipeline sebelumnya? Jawabannya sangat tergantung dengan kasus yang dihadapi, tergantung spesifikasi hardware-nya juga, dan mungkin juga tergantung dengan taste dari si engineer pembuat program.</p>
<p>Perbedaannya sebenarnya hanya pada bagian Fan-out Fan-in nya saja. Disini (hampir) semua pipeline isinya adalah gabungan dari Fan-out dan juga Fan-in. Jadi kita tidak perlu report <em>merge</em>. Dan juga beda lainnya adalah, jumlah worker bisa kita tentukan sesuai kebutuhan (<em>parameterized</em>).</p>
<p>Ok, agar lebih jelas mari kita mulai praktek.</p>
<h2 id="a601-skenario-praktek">A.60.1. Skenario Praktek</h2>
<p>Kita akan modifikasi file program <a href="A-concurrency-pipeline.html"><code>1-dummy-file-generator.go</code> yang pada chapter sebelumnya sudah dibuat</a>. Kita rubah mekanisme generate dummy files-nya dari sekuensial ke konkuren.</p>
<h2 id="a602-program-generate-dummy-file-sequentially">A.60.2. Program Generate Dummy File <em>Sequentially</em></h2>
<p>Ok langsung saja, pertama yang perlu dipersiapkan adalah tulis dulu kode program versi sekuensialnya. Bisa langsung copy-paste, atau tulis dari awal dengan mengikut tutorial ini secara keseluruhan. Untuk penjelasan detail program versi sekuensial silakan merujuk ke chapter sebelumnya saja, disini kita tulis langsung agar bisa cepat dimulai bagian program konkuren.</p>
<p>Siapkan folder projek baru, isinya satu buah file <code>1-generate-dummy-files-sequentially.go</code>.</p>
<h4 id="import-packages-dan-definisi-variabel">&#x2022; Import Packages dan Definisi Variabel</h4>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;fmt&quot;</span>
    <span class="hljs-string">&quot;io/ioutil&quot;</span>
    <span class="hljs-string">&quot;log&quot;</span>
    <span class="hljs-string">&quot;math/rand&quot;</span>
    <span class="hljs-string">&quot;os&quot;</span>
    <span class="hljs-string">&quot;path/filepath&quot;</span>
    <span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-keyword">const</span> totalFile = <span class="hljs-number">3000</span>
<span class="hljs-keyword">const</span> contentLength = <span class="hljs-number">5000</span>

<span class="hljs-keyword">var</span> tempPath = filepath.Join(os.Getenv(<span class="hljs-string">&quot;TEMP&quot;</span>), <span class="hljs-string">&quot;chapter-A.60-worker-pool&quot;</span>)
</code></pre>
<h4 id="fungsi-init-dan-main">&#x2022; Fungsi <code>init()</code> dan <code>main()</code></h4>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> init() {
    rand.Seed(time.Now().UnixNano())
}

<span class="hljs-keyword">func</span> main() {
    log.Println(<span class="hljs-string">&quot;start&quot;</span>)
    start := time.Now()

    generateFiles()

    duration := time.Since(start)
    log.Println(<span class="hljs-string">&quot;done in&quot;</span>, duration.Seconds(), <span class="hljs-string">&quot;seconds&quot;</span>)
}
</code></pre>
<h4 id="fungsi-randomstring">&#x2022; Fungsi <code>randomString()</code></h4>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> randomString(length <span class="hljs-keyword">int</span>) <span class="hljs-keyword">string</span> {
    letters := []<span class="hljs-keyword">rune</span>(<span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>)

    b := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">rune</span>, length)
    <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> b {
        b[i] = letters[rand.Intn(<span class="hljs-built_in">len</span>(letters))]
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">string</span>(b)
}
</code></pre>
<h4 id="fungsi-generatefiles">&#x2022; Fungsi <code>generateFiles()</code></h4>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> generateFiles() {
    os.RemoveAll(tempPath)
    os.MkdirAll(tempPath, os.ModePerm)

    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; totalFile; i++ {
        filename := filepath.Join(tempPath, fmt.Sprintf(<span class="hljs-string">&quot;file-%d.txt&quot;</span>, i))
        content := randomString(contentLength)
        err := ioutil.WriteFile(filename, []<span class="hljs-keyword">byte</span>(content), os.ModePerm)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            log.Println(<span class="hljs-string">&quot;Error writing file&quot;</span>, filename)
        }

        log.Println(i, <span class="hljs-string">&quot;files created&quot;</span>)
    }

    log.Printf(<span class="hljs-string">&quot;%d of total files created&quot;</span>, totalFile)
}
</code></pre>
<p>Pada bagian fungsi <code>generateFiles()</code> kali ini sedikit berbeda dibanding sebelumnya. Disini log <code>file created</code> tidak ditampilkan per seratus data, melainkan setiap file sukses dibuat. Ini memang akan berpengaruh ke performa, tapi diperlukan untuk perbandingan antara file-file yang di-generate secara sekuensial vs file-file yang di-generate secara konkuren.</p>
<p>Kita lanjut dulu saja. Berikut adalah output jika program di atas di-run.</p>
<p><img src="images/a_simplified_fan_in_fan_out_pipeline_1_generate_dummy_files_sequentially.png" alt="Generate dummy files sequentially"></p>
<h2 id="a603-program-generate-dummy-file-concurrently">A.60.3. Program Generate Dummy File <em>Concurrently</em></h2>
<p>Sekarang saya buat file program <code>2-generate-dummy-files-concurrently.go</code> yang isinya adalah sama yaitu untuk keperluan generate dummy files, tapi pembuatannya dilakukan secara konkuren.</p>
<h4 id="import-packages-dan-definisi-variabel">&#x2022; Import Packages dan Definisi Variabel</h4>
<p>Import beberapa hal pada file baru ini, lalu definisikan beberapa variabel juga.</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;fmt&quot;</span>
    <span class="hljs-string">&quot;io/ioutil&quot;</span>
    <span class="hljs-string">&quot;log&quot;</span>
    <span class="hljs-string">&quot;math/rand&quot;</span>
    <span class="hljs-string">&quot;os&quot;</span>
    <span class="hljs-string">&quot;path/filepath&quot;</span>
    <span class="hljs-string">&quot;sync&quot;</span>
    <span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-keyword">const</span> totalFile = <span class="hljs-number">3000</span>
<span class="hljs-keyword">const</span> contentLength = <span class="hljs-number">5000</span>

<span class="hljs-keyword">var</span> tempPath = filepath.Join(os.Getenv(<span class="hljs-string">&quot;TEMP&quot;</span>), <span class="hljs-string">&quot;chapter-A.60-worker-pool&quot;</span>)
</code></pre>
<h4 id="definisi-struct-fileinfo">&#x2022; Definisi struct <code>FileInfo</code></h4>
<p>Kita perlu siapkan struct baru bernama <code>FileInfo</code>, struct ini digunakan sebagai skema payload data ketika dikirimkan via channel dari goroutine jobs ke goroutine worker.</p>
<pre><code class="lang-go"><span class="hljs-keyword">type</span> FileInfo <span class="hljs-keyword">struct</span> {
    Index       <span class="hljs-keyword">int</span>
    FileName    <span class="hljs-keyword">string</span>
    WorkerIndex <span class="hljs-keyword">int</span>
    Err         error
}
</code></pre>
<ul>
<li>Property <code>Index</code> dan <code>FileName</code> menurut saya cukup jelas, isinya adalah angka dan nama file. Nama file sendiri formatnya adalah <code>file-&lt;index&gt;.txt</code>.</li>
<li>Property <code>WorkerIndex</code> digunakan sebagai penanda worker mana yang akan melakukan operasi pembuatan file tersebut.</li>
<li>Property <code>Err</code> default isinya kosong. Nantinya akan diisi dengan objek error ketika ada error saat pembuatan file.</li>
</ul>
<h4 id="fungsi-init-dan-main">&#x2022; Fungsi <code>init()</code> dan <code>main()</code></h4>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> init() {
    rand.Seed(time.Now().UnixNano())
}

<span class="hljs-keyword">func</span> main() {
    log.Println(<span class="hljs-string">&quot;start&quot;</span>)
    start := time.Now()

    generateFiles()

    duration := time.Since(start)
    log.Println(<span class="hljs-string">&quot;done in&quot;</span>, duration.Seconds(), <span class="hljs-string">&quot;seconds&quot;</span>)
}
</code></pre>
<h4 id="fungsi-randomstring">&#x2022; Fungsi <code>randomString()</code></h4>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> randomString(length <span class="hljs-keyword">int</span>) <span class="hljs-keyword">string</span> {
    letters := []<span class="hljs-keyword">rune</span>(<span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>)

    b := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">rune</span>, length)
    <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> b {
        b[i] = letters[rand.Intn(<span class="hljs-built_in">len</span>(letters))]
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">string</span>(b)
}
</code></pre>
<h4 id="fungsi-generatefiles">&#x2022; Fungsi <code>generateFiles()</code></h4>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> generateFiles() {
    os.RemoveAll(tempPath)
    os.MkdirAll(tempPath, os.ModePerm)

    <span class="hljs-comment">// pipeline 1: job distribution</span>
    chanFileIndex := generateFileIndexes()

    <span class="hljs-comment">// pipeline 2: the main logic (creating files)</span>
    createFilesWorker := <span class="hljs-number">100</span>
    chanFileResult := createFiles(chanFileIndex, createFilesWorker)

    <span class="hljs-comment">// track and print output</span>
    counterTotal := <span class="hljs-number">0</span>
    counterSuccess := <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> fileResult := <span class="hljs-keyword">range</span> chanFileResult {
        <span class="hljs-keyword">if</span> fileResult.Err != <span class="hljs-literal">nil</span> {
            log.Printf(<span class="hljs-string">&quot;error creating file %s. stack trace: %s&quot;</span>, fileResult.FileName, fileResult.Err)
        } <span class="hljs-keyword">else</span> {
            counterSuccess++
        }
        counterTotal++
    }

    log.Printf(<span class="hljs-string">&quot;%d/%d of total files created&quot;</span>, counterSuccess, counterTotal)
}
</code></pre>
<p>Isi fungsi generate files ini secara garis besar ada 3:</p>
<ul>
<li>Pipeline 1, bertugas men-<em>dispatch</em> goroutine untuk distribusi jobs.</li>
<li>Pipleine 2, bertugas men-<em>dispatch</em> goroutine untuk start worker yang masing-masing worker punya tugas utama yaitu membuat files.</li>
<li>Terakhir, tracking channel dari Fan-in nilai balik fungsi pipeline ke-2.</li>
</ul>
<p>Fungsi <code>generateFileIndexes()</code> nantinya akan mengembalikan channel <code>chanFileIndex</code> yang fungsi dari channel ini adalah untuk media komunikasi antara proses dalam fungsi <code>generateFileIndexes()</code> (yaitu distribusi jobs) dengan proses dalam fungsi selanjutnya yaitu <code>createFiles()</code>.</p>
<p>Fungsi <code>createFiles()</code> disini merupakan fungsi <strong>Fan-out Fan-in</strong> karena menerima parameter channel pipeline sebelumnya, lalu kemudian min-dispatch goroutine worker dan menge-track output dari masing-masing worker ke channel output. Jadi fungsi <code>createFiles()</code> ini merupakan gabungan dari fungsi Fan-out dan Fan-in (proses merge channel output dari Fan-out juga ada di dalam fungsi tersebut).</p>
<p>Fungsi <code>createFiles()</code> menghasilkan channel yang isinya merupakan result dari operasi tiap-tiap jobs. Dari data yang dilewatkan via channel tersebut akan ketahuan misal ada error atau tidak saat pembuatan files. Channel tersebut kemudian di-loop lalu ditampilkan tiap-tiap result-nya.</p>
<h4 id="fungsi-generatefileindexes">&#x2022; Fungsi <code>generateFileIndexes()</code></h4>
<p>Fungsi ini merupakan fungsi Fan-out distribusi jobs. Didalamnya dilakukan perulangan sejumlah <code>totalFile</code>, kemudian data tiap index digunakan untuk pembentukan filename lalu dikirim ke channel outputnya.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> generateFileIndexes() &lt;-<span class="hljs-keyword">chan</span> FileInfo {
    chanOut := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> FileInfo)

    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; totalFile; i++ {
            chanOut &lt;- FileInfo{
                Index:    i,
                FileName: fmt.Sprintf(<span class="hljs-string">&quot;file-%d.txt&quot;</span>, i),
            }
        }
        <span class="hljs-built_in">close</span>(chanOut)
    }()

    <span class="hljs-keyword">return</span> chanOut
}
</code></pre>
<p>Setelah dipastikan semua job terkirim, kita close channel output <code>chanOut</code> tersebut.</p>
<h4 id="fungsi-dispatchworkers">&#x2022; Fungsi <code>dispatchWorkers()</code></h4>
<p>Bagian ini merupakan yang paling butuh <em>effort</em> untuk dipahami. Jadi fungsi <code>createFiles()</code> seperti yang sudah saja jelaskan secara singkat di atas, fungsi ini merupakan fungsi gabungan Fan-out (menerima channel output dari pipeline sebelumnya) dan juga Fan-in (menjalankan beberapa worker untuk memproses channel output dari pipeline sebelumnya, lalu output masing-masing worker yang juga merupakan channel - langsung di merge jadi satu channel saja).</p>
<p>Mungkin lebih enak silakan tulis dulu fungsinya, lalu kita bahas satu per satu setelahnya.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> createFiles(chanIn &lt;-<span class="hljs-keyword">chan</span> FileInfo, numberOfWorkers <span class="hljs-keyword">int</span>) &lt;-<span class="hljs-keyword">chan</span> FileInfo {
    chanOut := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> FileInfo)

    <span class="hljs-comment">// wait group to control the workers</span>
    wg := <span class="hljs-built_in">new</span>(sync.WaitGroup)

    <span class="hljs-comment">// allocate N of workers</span>
    wg.Add(numberOfWorkers)

    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {

        <span class="hljs-comment">// dispatch N workers</span>
        <span class="hljs-keyword">for</span> workerIndex := <span class="hljs-number">0</span>; workerIndex &lt; numberOfWorkers; workerIndex++ {
            <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>(workerIndex <span class="hljs-keyword">int</span>) {

                <span class="hljs-comment">// listen to `chanIn` channel for incoming jobs</span>
                <span class="hljs-keyword">for</span> job := <span class="hljs-keyword">range</span> chanIn {

                    <span class="hljs-comment">// do the jobs</span>
                    filePath := filepath.Join(tempPath, job.FileName)
                    content := randomString(contentLength)
                    err := ioutil.WriteFile(filePath, []<span class="hljs-keyword">byte</span>(content), os.ModePerm)

                    log.Println(<span class="hljs-string">&quot;worker&quot;</span>, workerIndex, <span class="hljs-string">&quot;working on&quot;</span>, job.FileName, <span class="hljs-string">&quot;file generation&quot;</span>)

                    <span class="hljs-comment">// construct the job&apos;s result, and send it to `chanOut`</span>
                    chanOut &lt;- FileInfo{
                        FileName:    job.FileName,
                        WorkerIndex: workerIndex,
                        Err:         err,
                    }
                }

                <span class="hljs-comment">// if `chanIn` is closed, and the remaining jobs are finished,</span>
                <span class="hljs-comment">// only then we mark the worker as complete.</span>
                wg.Done()
            }(workerIndex)
        }
    }()

    <span class="hljs-comment">// wait until `chanIn` closed and then all workers are done,</span>
    <span class="hljs-comment">// because right after that - we need to close the `chanOut` channel.</span>
    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        wg.Wait()
        <span class="hljs-built_in">close</span>(chanOut)
    }()

    <span class="hljs-keyword">return</span> chanOut
}
</code></pre>
<p>Penjelasan:</p>
<ol>
<li>Pertama-tama, kita siapkan <code>chanOut</code> yang merupakan channel output Fan-in dari worker-worker yang ada. Channel ini langsung dijadikan nilai balik fungsi <code>createFiles()</code>. Saya gunakan kata <strong>langsung</strong> disitu karena semua proses lainnya selain deklarasi channel dan waitgroup - adalah berjalan secara asynchronous via goroutine.</li>
<li>Kemudian objek <code>sync.WaitGroup</code> didefinisikan, lalu di-<em>notify</em> bahwa akan ada sejumlah <code>numberOfWorkers</code> workers berjalan secara konkuren dan harus ditunggu. Jadi waitgroup ini untuk kerluan manajemen worker-nya.</li>
<li>Jalankan goroutine yang isinya dispatch sejumlah <code>numberOfWorkers</code> workers. Karena pada bagian ini ada goroutine dalam perulangan, maka informasi perulangan yang akan digunakan di dalam goroutine harus dijadikan argumen eksekusi goroutine (dalam contoh ini <code>workerIndex</code>).</li>
<li>Pantau channel <code>chanIn</code>, setiap ada job yg masuk maka kerjakan.</li>
<li>Output dari eksekusi job ada dua yaitu: error, atau tidak error. Informasi <em>truthy</em> ini disimpan dalam objek <code>FileInfo</code> result yang kemudian di-kirim ke <code>chanOut</code>.</li>
<li>Jika perulangan terhadap <code>chanIn</code> sudah selesai (ditandai dengan channel-nya closed), maka kita tandai juga worker sebagai complete via statement <code>wg.Done()</code></li>
<li>Dispatch goroutine baru lagi untuk menunggu semua worker selesai. Jika iya, maka kita close channel <code>chanOut</code>.</li>
</ol>
<p>Semoga cukup jelas ya. Kelebihan metode ini ini salah satunya adalah kita bisa dengan mudah menentukan jumlah workernya.</p>
<blockquote>
<p>Untuk temen-temen yang bingung, mungkin fungsi ini bisa dipecah menjadi satu fungsi Fan-out dan satu fungsi Fan-in seperti chapter sebelumnya.</p>
</blockquote>
<h2 id="a604-test-eksekusi-program">A.60.4. Test Eksekusi Program</h2>
<p>Saya akan coba jalankan program pertama dan kedua, lalu mari kita lihat perbedaannya.</p>
<h4 id="program-generate-dummy-file-sequentially">&#x2022; Program Generate Dummy File <em>Sequentially</em></h4>
<p><img src="images/a_simplified_fan_in_fan_out_pipeline_2_benchmark.png" alt="Generate dummy files sequentially"></p>
<p>Testing di awal chapter ini hasilnya butuh sekitar <strong>19 detik</strong> untuk menyelesaikan generate dummy files sebanyak 3000 secara sekuensial. Tapi kali ini lebih lambat, yaitu <strong>23 detik</strong> dan ini wajar, karena di tiap operasi kita munculkan log ke stdout (via <code>log.Println()</code>).</p>
<h4 id="program-generate-dummy-file-concurrently">&#x2022; Program Generate Dummy File <em>Concurrently</em></h4>
<p><img src="images/a_simplified_fan_in_fan_out_pipeline_3_concurrent.png" alt="Generate dummy files concurrently"></p>
<p>Bandingkan dengan ini, <strong>3 detik</strong> saja! luar biasa sekali bukan beda performanya. Dan pastinya akan lebih cepat lagi kalau kita hapus statement untuk logging ke stdout (<code>log.Println()</code>).</p>
<p>Nah dari sini semoga cukup jelas ya bedanya kalau dari sisi performa. Inilah pentingnya kenapa konkurensi di Go harus diterapkan (untuk kasus yang memang bisa di-konkurensikan prosesnya). Tapi temen-temen juga harus hati-hati dalam mendesain pipeline dan menentukan jumlah workernya, karena jika tidak tepat bisa makan <em>resources</em> seperti CPU dan RAM cukup tinggi.</p>
<blockquote>
<p>Untuk menentukan jumlah worker yang ideal, caranya adalah dengan coba-coba dan disesuaikan dengan spesifikasi server/laptopnya. Jadi tidak ada angka yang pasti berapa jumlah worker ideal. Sangat tergantung ke banyak hal (jenis proses, jumlah pipeline, jumlah worker per pipeline, spesifikasi hardware, dsb).</p>
</blockquote>
<hr>
<div class="source-code-link">
    <div class="source-code-link-message">Source code praktek pada bab ini tersedia di Github</div>
    <a href="https://github.com/novalagung/dasarpemrogramangolang-example/tree/master/chapter-A-simplified-fan-in-fan-out-pipeline" target="_blank">https://github.com/novalagung/dasarpemrogramangolang-example/...</a>
</div>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="A-concurrency-pipeline.html" class="navigation navigation-prev " aria-label="Previous page: A.59. Concurrency Pattern: Pipeline">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="A-pipeline-context-cancellation.html" class="navigation navigation-next " aria-label="Next page: A.61. Concurrency Pattern: Context Cancellation Pipeline">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"A.60. Concurrency Pattern: Simplified Fan-in Fan-out Pipeline","level":"2.1.60","depth":2,"next":{"title":"A.61. Concurrency Pattern: Context Cancellation Pipeline","level":"2.1.61","depth":2,"path":"A-pipeline-context-cancellation.md","ref":"A-pipeline-context-cancellation.md","articles":[]},"previous":{"title":"A.59. Concurrency Pattern: Pipeline","level":"2.1.59","depth":2,"path":"A-concurrency-pipeline.md","ref":"A-concurrency-pipeline.md","articles":[]},"dir":"ltr"},"config":{"plugins":["ga","disqus","meta","sitemap"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"dasarpemrogramangolang"},"meta":{"content":"","data":[{"name":"google-site-verification","content":"UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE"},{"name":"og:image","content":"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"},{"name":"twitter:image","content":"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"}],"name":""},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sitemap":{"hostname":"https://dasarpemrogramangolang.novalagung.com/"},"ga":{"configuration":"auto","token":"UA-27602984-29"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","lunr":{"maxIndexSize":1000000000},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"A-simplified-fan-in-fan-out-pipeline.md","mtime":"2020-05-17T12:04:58.899Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-05-17T12:05:55.558Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    <div style="position: fixed; top: 10px; right: 30px; padding: 10px; background-color: rgba(255, 255, 255, 0.7);"><a class="github-button" href="https://github.com/novalagung/dasarpemrogramangolang" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star novalagung/dasarpemrogramangolang on GitHub">Star</a>&nbsp;<a class="github-button" href="https://github.com/novalagung" data-size="large" aria-label="Follow @novalagung on GitHub">Follow @novalagung</a><script async defer src="https://buttons.github.io/buttons.js"></script></div><div class="banner-container" onclick="this.style.display = 'none';"><div><a target="_blank" href="https://www.udemy.com/course/praktis-belajar-docker-dan-kubernetes-untuk-pemula/"><img src="/images/banner.png?v=2.2020.05.17.120620"></a></div></div><script>var bannerCounter = parseInt(localStorage.getItem("banner-counter")); if (isNaN(bannerCounter)) { bannerCounter = 0; } var bannerEl = document.querySelector('.banner-container'); if (bannerCounter % 5 === 0 && bannerEl) { bannerEl.style.display = 'block'; } localStorage.setItem("banner-counter", String(bannerCounter + 1));</script></body>
</html>

