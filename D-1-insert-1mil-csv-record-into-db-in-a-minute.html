
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>D.1. Golang Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover - Dasar Pemrograman Golang</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta  name="google-site-verification"  content="UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE" >
    
    <meta  name="og:image"  content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg" >
    
    <meta  name="twitter:image"  content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg" >
    
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    


    <link rel="stylesheet" href="/adjustment.css?v=2.2020.05.15.035038"><script async defer src="https://buttons.github.io/buttons.js"></script></head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Dasar Pemrograman Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="CONTRIBUTORS.html">
            
                <a href="CONTRIBUTORS.html">
            
                    
                    Kontributor
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <span>
            
                    
                    A. Pemrograman Go Dasar
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="1-berkenalan-dengan-golang.html">
            
                <a href="1-berkenalan-dengan-golang.html">
            
                    
                    A.1. Belajar Golang (Perkenalan)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="2-instalasi-golang.html">
            
                <a href="2-instalasi-golang.html">
            
                    
                    A.2. Instalasi Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" >
            
                <span>
            
                    
                    A.3. Setup Project dan GOPATH
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.3.1" data-path="3-setup-go-project-dengan-go-modules.html">
            
                <a href="3-setup-go-project-dengan-go-modules.html">
            
                    
                    A.3.A. Go Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3.2" data-path="3-gopath-dan-workspace.html">
            
                <a href="3-gopath-dan-workspace.html">
            
                    
                    A.3.B. GOPATH Dan Workspace
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="4-instalasi-editor.html">
            
                <a href="4-instalasi-editor.html">
            
                    
                    A.4. Instalasi Editor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="5-go-command.html">
            
                <a href="5-go-command.html">
            
                    
                    A.5. Go Command
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.6" data-path="6-hello-world.html">
            
                <a href="6-hello-world.html">
            
                    
                    A.6. Program Pertama: Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7" data-path="7-komentar.html">
            
                <a href="7-komentar.html">
            
                    
                    A.7. Komentar
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.8" data-path="8-variabel.html">
            
                <a href="8-variabel.html">
            
                    
                    A.8. Variabel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.9" data-path="9-tipe-data.html">
            
                <a href="9-tipe-data.html">
            
                    
                    A.9. Tipe Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.10" data-path="10-konstanta.html">
            
                <a href="10-konstanta.html">
            
                    
                    A.10. Konstanta
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.11" data-path="11-operator.html">
            
                <a href="11-operator.html">
            
                    
                    A.11. Operator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.12" data-path="12-seleksi-kondisi.html">
            
                <a href="12-seleksi-kondisi.html">
            
                    
                    A.12. Seleksi Kondisi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.13" data-path="13-perulangan.html">
            
                <a href="13-perulangan.html">
            
                    
                    A.13. Perulangan
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.14" data-path="14-array.html">
            
                <a href="14-array.html">
            
                    
                    A.14. Array
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.15" data-path="15-slice.html">
            
                <a href="15-slice.html">
            
                    
                    A.15. Slice
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.16" data-path="16-map.html">
            
                <a href="16-map.html">
            
                    
                    A.16. Map
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.17" data-path="17-fungsi.html">
            
                <a href="17-fungsi.html">
            
                    
                    A.17. Fungsi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.18" data-path="18-fungsi-multiple-return.html">
            
                <a href="18-fungsi-multiple-return.html">
            
                    
                    A.18. Fungsi Multiple Return
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.19" data-path="19-fungsi-variadic.html">
            
                <a href="19-fungsi-variadic.html">
            
                    
                    A.19. Fungsi Variadic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.20" data-path="20-fungsi-closure.html">
            
                <a href="20-fungsi-closure.html">
            
                    
                    A.20. Fungsi Closure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.21" data-path="21-fungsi-sebagai-parameter.html">
            
                <a href="21-fungsi-sebagai-parameter.html">
            
                    
                    A.21. Fungsi Sebagai parameter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.22" data-path="22-pointer.html">
            
                <a href="22-pointer.html">
            
                    
                    A.22. Pointer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.23" data-path="23-struct.html">
            
                <a href="23-struct.html">
            
                    
                    A.23. Struct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.24" data-path="24-method.html">
            
                <a href="24-method.html">
            
                    
                    A.24. Method
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.25" data-path="25-properti-public-dan-private.html">
            
                <a href="25-properti-public-dan-private.html">
            
                    
                    A.25. Properti Public dan Private (Exported vs Unexported)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.26" data-path="26-interface.html">
            
                <a href="26-interface.html">
            
                    
                    A.26. Interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.27" data-path="27-interface-kosong.html">
            
                <a href="27-interface-kosong.html">
            
                    
                    A.27. Interface Kosong
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.28" data-path="28-reflect.html">
            
                <a href="28-reflect.html">
            
                    
                    A.28. Reflect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.29" data-path="29-goroutine.html">
            
                <a href="29-goroutine.html">
            
                    
                    A.29. Goroutine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.30" data-path="30-channel.html">
            
                <a href="30-channel.html">
            
                    
                    A.30. Channel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.31" data-path="31-buffered-channel.html">
            
                <a href="31-buffered-channel.html">
            
                    
                    A.31. Buffered Channel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.32" data-path="32-channel-select.html">
            
                <a href="32-channel-select.html">
            
                    
                    A.32. Channel - Select
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.33" data-path="33-channel-range-close.html">
            
                <a href="33-channel-range-close.html">
            
                    
                    A.33. Channel - Range & Close
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.34" data-path="34-channel-timeout.html">
            
                <a href="34-channel-timeout.html">
            
                    
                    A.34. Channel - Timeout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.35" data-path="35-defer-exit.html">
            
                <a href="35-defer-exit.html">
            
                    
                    A.35. Defer & Exit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.36" data-path="36-error-panic-recover.html">
            
                <a href="36-error-panic-recover.html">
            
                    
                    A.36. Error, Panic, & Recover
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.37" data-path="37-string-format.html">
            
                <a href="37-string-format.html">
            
                    
                    A.37. Layout Format String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.38" data-path="38-time.html">
            
                <a href="38-time.html">
            
                    
                    A.38. Time, Parsing Time, & Format Time
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.39" data-path="39-timer.html">
            
                <a href="39-timer.html">
            
                    
                    A.39. Timer, Ticker, & Scheduler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.40" data-path="40-data-type-conversion.html">
            
                <a href="40-data-type-conversion.html">
            
                    
                    A.40. Konversi Antar Tipe Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.41" data-path="41-strings.html">
            
                <a href="41-strings.html">
            
                    
                    A.41. Fungsi String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.42" data-path="42-regex.html">
            
                <a href="42-regex.html">
            
                    
                    A.42. Regex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.43" data-path="43-encoding-base64.html">
            
                <a href="43-encoding-base64.html">
            
                    
                    A.43. Encode - Decode Base64
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.44" data-path="44-hash-sha1.html">
            
                <a href="44-hash-sha1.html">
            
                    
                    A.44. Hash Sha1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.45" data-path="45-command-line-args-flag.html">
            
                <a href="45-command-line-args-flag.html">
            
                    
                    A.45. Arguments & Flag
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.46" data-path="46-exec.html">
            
                <a href="46-exec.html">
            
                    
                    A.46. Exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.47" data-path="47-file.html">
            
                <a href="47-file.html">
            
                    
                    A.47. File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.48" data-path="48-web.html">
            
                <a href="48-web.html">
            
                    
                    A.48. Web
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.49" data-path="49-url-parsing.html">
            
                <a href="49-url-parsing.html">
            
                    
                    A.49. URL Parsing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.50" data-path="50-json.html">
            
                <a href="50-json.html">
            
                    
                    A.50. JSON
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.51" data-path="51-web-json-api.html">
            
                <a href="51-web-json-api.html">
            
                    
                    A.51. Web Service API (JSON Data)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.52" data-path="52-http-request.html">
            
                <a href="52-http-request.html">
            
                    
                    A.52. HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.53" data-path="53-sql.html">
            
                <a href="53-sql.html">
            
                    
                    A.53. SQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.54" data-path="54-mongodb.html">
            
                <a href="54-mongodb.html">
            
                    
                    A.54. NoSQL MongoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.55" data-path="55-unit-test.html">
            
                <a href="55-unit-test.html">
            
                    
                    A.55. Unit Test
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.56" data-path="56-waitgroup.html">
            
                <a href="56-waitgroup.html">
            
                    
                    A.56. WaitGroup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.57" data-path="57-mutex.html">
            
                <a href="57-mutex.html">
            
                    
                    A.57. Mutex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.58" data-path="A-58-go-vendoring.html">
            
                <a href="A-58-go-vendoring.html">
            
                    
                    A.58. Go Vendoring
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <span>
            
                    
                    B. Pemrograman Web Go Dasar
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="B-1-golang-web-hello-world.html">
            
                <a href="B-1-golang-web-hello-world.html">
            
                    
                    B.1. Golang Web App: Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="B-2-routing-http-handlefunc.html">
            
                <a href="B-2-routing-http-handlefunc.html">
            
                    
                    B.2. Routing http.HandleFunc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="B-3-routing-static-assets.html">
            
                <a href="B-3-routing-static-assets.html">
            
                    
                    B.3. Routing Static Assets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="B-4-template-render-html.html">
            
                <a href="B-4-template-render-html.html">
            
                    
                    B.4. Template: Render HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="B-5-template-render-partial-html.html">
            
                <a href="B-5-template-render-partial-html.html">
            
                    
                    B.5. Template: Render Partial HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="B-6-template-actions-variables.html">
            
                <a href="B-6-template-actions-variables.html">
            
                    
                    B.6. Template: Actions & Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7" data-path="B-7-template-functions.html">
            
                <a href="B-7-template-functions.html">
            
                    
                    B.7. Template: Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8" data-path="B-8-template-custom-functions.html">
            
                <a href="B-8-template-custom-functions.html">
            
                    
                    B.8. Template: Custom Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.9" data-path="B-9-render-specific-html-template.html">
            
                <a href="B-9-render-specific-html-template.html">
            
                    
                    B.9. Template: Render Specific HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.10" data-path="B-10-render-html-string.html">
            
                <a href="B-10-render-html-string.html">
            
                    
                    B.10. Template: Render HTML String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.11" data-path="B-11-http-method.html">
            
                <a href="B-11-http-method.html">
            
                    
                    B.11. HTTP Method: POST & GET
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.12" data-path="B-12-form-value.html">
            
                <a href="B-12-form-value.html">
            
                    
                    B.12. Form Value
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.13" data-path="B-13-form-upload-file.html">
            
                <a href="B-13-form-upload-file.html">
            
                    
                    B.13. Form Upload File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.14" data-path="B-14-ajax-json-payload.html">
            
                <a href="B-14-ajax-json-payload.html">
            
                    
                    B.14. AJAX JSON Payload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.15" data-path="B-15-ajax-json-response.html">
            
                <a href="B-15-ajax-json-response.html">
            
                    
                    B.15. AJAX JSON Response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.16" data-path="B-16-ajax-multi-upload.html">
            
                <a href="B-16-ajax-multi-upload.html">
            
                    
                    B.16. AJAX Multiple File Upload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.17" data-path="B-17-download-file.html">
            
                <a href="B-17-download-file.html">
            
                    
                    B.17. Download File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.18" data-path="B-18-http-basic-auth.html">
            
                <a href="B-18-http-basic-auth.html">
            
                    
                    B.18. HTTP Basic Auth
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.19" data-path="B-19-middleware-using-http-handler.html">
            
                <a href="B-19-middleware-using-http-handler.html">
            
                    
                    B.19. Middleware http.Handler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.20" data-path="B-20-custom-mux-multiplexer.html">
            
                <a href="B-20-custom-mux-multiplexer.html">
            
                    
                    B.20. Custom Multiplexer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.21" data-path="B-21-cookie.html">
            
                <a href="B-21-cookie.html">
            
                    
                    B.21. HTTP Cookie
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.22" data-path="B-22-simple-configuration.html">
            
                <a href="B-22-simple-configuration.html">
            
                    
                    B.22. Simple Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.23" data-path="B-23-server-handle-cancelled-http-request.html">
            
                <a href="B-23-server-handle-cancelled-http-request.html">
            
                    
                    B.23. Cancelled HTTP Request Handler
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" >
            
                <span>
            
                    
                    C. Pemrograman Go Lanjut
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="C-1-echo-routing.html">
            
                <a href="C-1-echo-routing.html">
            
                    
                    C.1. Echo Framework & Routing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="C-2-parsing-http-request-payload-echo.html">
            
                <a href="C-2-parsing-http-request-payload-echo.html">
            
                    
                    C.2. Parsing HTTP Request Payload (Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="C-3-http-request-payload-validation.html">
            
                <a href="C-3-http-request-payload-validation.html">
            
                    
                    C.3. HTTP Request Payload Validation (Validator v9, Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="C-4-http-error-handling.html">
            
                <a href="C-4-http-error-handling.html">
            
                    
                    C.4. HTTP Error Handling (Validator v9, Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="C-5-echo-template-rendering.html">
            
                <a href="C-5-echo-template-rendering.html">
            
                    
                    C.5. Template Rendering in Echo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6" data-path="C-6-advanced-middleware-and-logging.html">
            
                <a href="C-6-advanced-middleware-and-logging.html">
            
                    
                    C.6. Advanced Middleware & Logging (Logrus, Echo Logger)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7" data-path="C-7-flag-parser.html">
            
                <a href="C-7-flag-parser.html">
            
                    
                    C.7. CLI Flag Parser (Kingpin)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.8" >
            
                <span>
            
                    
                    C.8. Advanced Configuration
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.8.1" data-path="C-8-A-advanced-configuration-viper.html">
            
                <a href="C-8-A-advanced-configuration-viper.html">
            
                    
                    C.8.A. Advanced Configuration: Viper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.8.2" data-path="C-8-B-best-practice-configuration-env-var.html">
            
                <a href="C-8-B-best-practice-configuration-env-var.html">
            
                    
                    C.8.B. Best Practice Configuration: Environment Variable
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.9" data-path="C-9-securecookie.html">
            
                <a href="C-9-securecookie.html">
            
                    
                    C.9. Secure Cookie (Gorilla Securecookie)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.10" data-path="C-10-session.html">
            
                <a href="C-10-session.html">
            
                    
                    C.10. Session (Gorilla Session)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.11" data-path="C-12-cors-preflight-request.html">
            
                <a href="C-12-cors-preflight-request.html">
            
                    
                    C.12. CORS & Preflight Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.12" data-path="C-13-csrf.html">
            
                <a href="C-13-csrf.html">
            
                    
                    C.13. CSRF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.13" data-path="C-14-secure-middleware.html">
            
                <a href="C-14-secure-middleware.html">
            
                    
                    C.14. Secure Middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.14" data-path="C-15-http-gzip-compression.html">
            
                <a href="C-15-http-gzip-compression.html">
            
                    
                    C.15. HTTP Gzip Compression (gziphandler)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.15" data-path="C-16-send-email.html">
            
                <a href="C-16-send-email.html">
            
                    
                    C.16. Send Mail (net/smtp, Gomail v2)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.16" data-path="C-17-read-write-excel-xlsx-file.html">
            
                <a href="C-17-read-write-excel-xlsx-file.html">
            
                    
                    C.17. Read & Write Excel XLSX File (Excelize)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.17" data-path="C-18-write-pdf-file.html">
            
                <a href="C-18-write-pdf-file.html">
            
                    
                    C.18. Write PDF File (gofpdf)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.18" data-path="C-19-convert-html-to-pdf.html">
            
                <a href="C-19-convert-html-to-pdf.html">
            
                    
                    C.19. Convert HTML to PDF (go-wkhtmltopdf)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.19" data-path="C-20-scraping-parsing-html.html">
            
                <a href="C-20-scraping-parsing-html.html">
            
                    
                    C.20. Scraping & Parsing HTML (goquery)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.20" data-path="C-21-xml-parser.html">
            
                <a href="C-21-xml-parser.html">
            
                    
                    C.21. Parse & Generate XML (etree)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.21" data-path="C-22-https-tls.html">
            
                <a href="C-22-https-tls.html">
            
                    
                    C.22. HTTPS/TLS Web Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.22" data-path="C-23-http2-server-push.html">
            
                <a href="C-23-http2-server-push.html">
            
                    
                    C.23. HTTP/2 & HTTP/2 Server Push
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.23" data-path="C-24-client-http-request.html">
            
                <a href="C-24-client-http-request.html">
            
                    
                    C.24. Client HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.24" data-path="C-25-secure-insecure-client-http-request.html">
            
                <a href="C-25-secure-insecure-client-http-request.html">
            
                    
                    C.25. Secure & Insecure Client HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.25" data-path="C-26-golang-ftp.html">
            
                <a href="C-26-golang-ftp.html">
            
                    
                    C.26. FTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.26" data-path="C-27-golang-ssh-sftp.html">
            
                <a href="C-27-golang-ssh-sftp.html">
            
                    
                    C.27. SSH & SFTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.27" data-path="C-28-golang-web-socket.html">
            
                <a href="C-28-golang-web-socket.html">
            
                    
                    C.28. Web Socket: Chatting App
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.28" data-path="C-29-golang-protobuf-implementation.html">
            
                <a href="C-29-golang-protobuf-implementation.html">
            
                    
                    C.29. Protobuf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.29" data-path="C-30-golang-grpc-protobuf.html">
            
                <a href="C-30-golang-grpc-protobuf.html">
            
                    
                    C.30. gRPC + Protobuf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.30" data-path="C-31-golang-context.html">
            
                <a href="C-31-golang-context.html">
            
                    
                    C.31. Context: Value, Timeout, & Cancellation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.31" data-path="C-32-golang-jwt.html">
            
                <a href="C-32-golang-jwt.html">
            
                    
                    C.32. JSON Web Token (JWT)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.32" data-path="C-33-golang-ldap-authentication.html">
            
                <a href="C-33-golang-ldap-authentication.html">
            
                    
                    C.33. LDAP Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.33" data-path="C-34-golang-sso-saml-sp.html">
            
                <a href="C-34-golang-sso-saml-sp.html">
            
                    
                    C.34. SSO SAML (Service Provider)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.34" data-path="C-35-dockerize-golang.html">
            
                <a href="C-35-dockerize-golang.html">
            
                    
                    C.35. Dockerize Aplikasi Golang
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1" >
            
                <span>
            
                    
                    D. Studi Kasus
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="5.1.1" data-path="D-1-insert-1mil-csv-record-into-db-in-a-minute.html">
            
                <a href="D-1-insert-1mil-csv-record-into-db-in-a-minute.html">
            
                    
                    D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="d1-insert-1-juta-data-dari-file-csv-ke-database-server-menggunakan-teknik-worker-pool-database-connection-pool-dan-mekanisme-failover">D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover.</h1>
<p>Pada bab ini kita akan praktek penerapan salah satu teknik concurrent programming di Go yaitu worker pool, dikombinasikan dengan database connection pool, untuk membaca 1jt rows data dari sebuah file csv untuk kemudian di-insert-kan ke mysql server.</p>
<p>Pada bagian insert data kita terapkan mekanisme failover, jadi ketika ada operasi insert gagal, maka akan otomatis di recover dan di retry. Jadi idealnya di akhir, semua data, sejumlah satu juta, akan berhasil di-insert.</p>
<h2 id="d11-penjelasan">D.1.1. Penjelasan</h2>
<h4 id="worker-pool">&#x2022; Worker Pool</h4>
<p>Worker pool adalah teknik manajemen goroutine dalam <em>concurrent programming</em> pada Go. Sejumlah worker dijalankan dan masing-masing memiliki tugas yang sama yaitu menyelesaikan sejumlah jobs.</p>
<p>Dengan metode worker pool ini, maka penggunaan memory dan performansi program akan bisa optimal.</p>
<h4 id="database-connection-pool">&#x2022; Database Connection Pool</h4>
<p><em>Connection pool</em> adalah metode untuk manajemen sejumlah koneksi database, agar bisa digunakan secara optimal.</p>
<p>Connection pool sangat penting dalam kasus operasi data yang berhubungan dengan database yang dimana concurrent programming diterapkan.</p>
<p>Karena pada concurrent programming, beberapa proses akan berjalan bersamaan, maka penggunaan 1 koneksi db akan menghambat proses tersebut. Perlu ada beberapa koneksi database, agar goroutine tidak rebutan objek koneksi database.</p>
<h4 id="failover">&#x2022; Failover</h4>
<p>Failover merupakan mekanisme backup ketika sebuah proses gagal. Pada konteks ini, failover mengarah ke proses untuk me-retry operasi insert ketika gagal.</p>
<h2 id="d12-persiapan">D.1.2. Persiapan</h2>
<p>File <a href="https://blog.majestic.com/development/majestic-million-csv-daily/" target="_blank">majestic-million-csv</a> digunakan sebagai bahan dalam praktek. File tersebut gratis dengan lisensi CCA3. Isinya adalah list dari top website berjumlah 1jt.</p>
<p>Silakan download file nya disini <a href="http://downloads.majestic.com/majestic_million.csv" target="_blank">http://downloads.majestic.com/majestic_million.csv</a>.</p>
<p>Setelah itu siapkan My SQL database server, create database dan sebuah tabel di dalamnya dengan nama domain.</p>
<pre><code class="lang-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-keyword">test</span>;
<span class="hljs-keyword">USE</span> <span class="hljs-keyword">test</span>;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-keyword">domain</span> (
    GlobalRank <span class="hljs-built_in">int</span>,
    TldRank <span class="hljs-built_in">int</span>,
    <span class="hljs-keyword">Domain</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),
    TLD <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),
    RefSubNets <span class="hljs-built_in">int</span>,
    RefIPs <span class="hljs-built_in">int</span>,
    IDN_Domain <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),
    IDN_TLD <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),
    PrevGlobalRank <span class="hljs-built_in">int</span>,
    PrevTldRank <span class="hljs-built_in">int</span>,
    PrevRefSubNets <span class="hljs-built_in">int</span>,
    PrevRefIPs <span class="hljs-built_in">int</span>
);
</code></pre>
<p>Setelah itu buat projek baru, dan sebuah file <code>main.go</code>, dan tempatkan file csv yang sudah didownload dalam folder yang sama.</p>
<p>Karena di contoh ini saya menggunakan My SQL, maka perlu untuk go get driver RDBMS ini untuk go.</p>
<pre><code class="lang-bash">go get -u github.com/go-sql-driver/mysql
</code></pre>
<p>Jika pembaca ingin menggunakan driver lain, juga silakan.</p>
<h2 id="d13-praktek">D.1.3. Praktek</h2>
<h4 id="definisi-konstanta">&#x2022; Definisi Konstanta</h4>
<p>Ada beberapa konstanta yang perlu dipersiapkan. Pertama connection string untuk komunikasi ke database server. Sesuaikan value nya dengan yang dipergunakan.</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> dbConnString = <span class="hljs-string">&quot;root@/test&quot;</span>
</code></pre>
<p>Lalu jumlah koneksi idle yang diperbolehkan, kita set saja 4, karena nantinya semua connection yg di create akan sibuk untuk bekerja meng-insert data.</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> dbMaxIdleConns = <span class="hljs-number">4</span>
</code></pre>
<p>Jumlah maksimum koneksi database dalam pool.</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> dbMaxConns = <span class="hljs-number">100</span>
</code></pre>
<p>Jumlah worker yang akan bekerja untuk menjalankan job.</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> totalWorker = <span class="hljs-number">100</span>
</code></pre>
<p>Path dari file CSV. Karena file berada satu level dengan <code>main.go</code> maka tulis saja nama file nya.</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> csvFile = <span class="hljs-string">&quot;majestic_million.csv&quot;</span>
</code></pre>
<p>Terakhir, siapkan variabel untuk menampung data header dari pembacaan CSV nanti.</p>
<pre><code class="lang-go"><span class="hljs-keyword">var</span> dataHeaders = <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">string</span>, <span class="hljs-number">0</span>)
</code></pre>
<h4 id="fungsi-buka-koneksi-database">&#x2022; Fungsi Buka Koneksi Database</h4>
<p>Buat fungsi untuk buka koneksi database, yg dikembalikan objek database kembalian fungsi <code>sql.Open()</code>.</p>
<p>Jangan lupa set nilai <code>MaxOpenConns</code> dan <code>MaxIdleConns</code>.</p>
<p>O iya, untuk yang tidak menggunakan mysql, maka sesuaikan saja nilai argument pertama statement <code>sql.Open()</code>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> openDbConnection() (*sql.DB, error) {
    log.Println(<span class="hljs-string">&quot;=&gt; open db connection&quot;</span>)

    db, err := sql.Open(<span class="hljs-string">&quot;mysql&quot;</span>, dbConnString)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    db.SetMaxOpenConns(dbMaxConns)
    db.SetMaxIdleConns(dbMaxIdleConns)

    <span class="hljs-keyword">return</span> db, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>O iya jangan lupa untuk import driver nya.</p>
<pre><code class="lang-go"><span class="hljs-keyword">import</span> _ <span class="hljs-string">&quot;github.com/go-sql-driver/mysql&quot;</span>
</code></pre>
<h4 id="fungsi-baca-csv">&#x2022; Fungsi Baca CSV</h4>
<p>Buka file CSV, lalu gunakan objek file untuk membuat objek CSV reader baru.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> openCsvFile() (*csv.Reader, *os.File, error) {
    log.Println(<span class="hljs-string">&quot;=&gt; open csv file&quot;</span>)

    f, err := os.Open(csvFile)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>, err
    }

    reader := csv.NewReader(f)
    <span class="hljs-keyword">return</span> reader, f, <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 id="fungsi-menjalankan-workers">&#x2022; Fungsi Menjalankan Workers</h4>
<p>Ok, sekarang kita mulai masuk ke aspek konkurensi dari pembahasan ini. Siapkan fungsi yang isinya men-dispatch beberapa goroutine sejumlah <code>totalWorker</code>.</p>
<p>Tiap-tiap goroutine tersebut adalah worker atau pekerja, yang tugasnya nanti akan meng-insert data ke database.</p>
<p>Saat aplikasi dijalankan, sejumlah 100 worker akan berlomba-lomba menyelesaikan job insert data sejumlah 1jt data.</p>
<p>1 job adalah 1 data, maka rata-rata setiap worker akan menyelesaikan operasi insert sekitar 10k. Tapi ini jelasnya tidak pasti karena worker akan berkompetisi dalam penyelesaian job, jadi sangat besar kemungkinan akan ada job yang menyelesaikan lebih dari 10k jobs, ataupun yg dibawah 10k jobs.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> dispatchWorkers(db *sql.DB, jobs &lt;-<span class="hljs-keyword">chan</span> []<span class="hljs-keyword">interface</span>{}, wg *sync.WaitGroup) {
    <span class="hljs-keyword">for</span> workerIndex := <span class="hljs-number">0</span>; workerIndex &lt;= totalWorker; workerIndex++ {
        <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>(workerIndex <span class="hljs-keyword">int</span>, db *sql.DB, jobs &lt;-<span class="hljs-keyword">chan</span> []<span class="hljs-keyword">interface</span>{}, wg *sync.WaitGroup) {
            counter := <span class="hljs-number">0</span>

            <span class="hljs-keyword">for</span> job := <span class="hljs-keyword">range</span> jobs {
                doTheJob(workerIndex, counter, db, job)
                wg.Done()
                counter++
            }
        }(workerIndex, db, jobs, wg)
    }
}
</code></pre>
<p>Bisa dilihat dalam fungsi di atas, di dalam goroutine/worker, isi channel jobs (yang berupa data dari proses pembacaan CSV), didistribusikan ke worker, ke goroutine.</p>
<p>Fungsi <code>doTheJob()</code> yang nantinya kita buat, isinya adalah operasi insert data ke database server. Setiap satu operasi insert selesai, <code>wg.Done()</code> untuk menandai bahwa 1 job adalah selesai.</p>
<p>Idealnya di akhir aplikasi akan terjadi pemanggilan <code>wg.Done()</code> sejumlah 1jt karena ada 1jt jobs.</p>
<h4 id="fungsi-baca-csv-dan-pengiriman-jobs-ke-worker">&#x2022; Fungsi Baca CSV dan Pengiriman Jobs ke Worker</h4>
<p>Proses pembacaan CSV, apapun metodenya pasti yang dijalankan adalah membaca data dari line ke line dari baris paling bawah.</p>
<blockquote>
<p>Proses baca satu file tidak bisa di-konkurensi-kan</p>
</blockquote>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> readCsvFilePerLineThenSendToWorker(csvReader *csv.Reader, jobs <span class="hljs-keyword">chan</span>&lt;- []<span class="hljs-keyword">interface</span>{}, wg *sync.WaitGroup) {
    <span class="hljs-keyword">for</span> {
        row, err := csvReader.Read()
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">if</span> err == io.EOF {
                err = <span class="hljs-literal">nil</span>
            }
            <span class="hljs-keyword">break</span>
        }

        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(dataHeaders) == <span class="hljs-number">0</span> {
            dataHeaders = row
            <span class="hljs-keyword">continue</span>
        }

        rowOrdered := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">interface</span>{}, <span class="hljs-number">0</span>)
        <span class="hljs-keyword">for</span> _, each := <span class="hljs-keyword">range</span> row {
            rowOrdered = <span class="hljs-built_in">append</span>(rowOrdered, each)
        }

        wg.Add(<span class="hljs-number">1</span>)
        jobs &lt;- rowOrdered
    }
    <span class="hljs-built_in">close</span>(jobs)
}
</code></pre>
<p>Data dibaca dalam perulangan per baris. Pada pembacaan pertama, rows akan ditampung ke variabel <code>dataHeaders</code>. Selanjutnya, data dikirimkan ke worker lewat channel <code>jobs</code>.</p>
<p>Setelah proses baca data selesai, channel di close. Karena pengiriman dan penerimaan data pada channel bersifat synchronous untuk unbuffered channel. Jadi aman untuk berasumsi bahwa ketika semua data berhasil dikirim, maka semua data tersebut juga berhasil diterima.</p>
<p>Jika blok kode perulangan dalam fungsi di atas selesai, maka sudah tidak ada lagi operasi kirim terima data, maka kita close channelnya.</p>
<h4 id="fungsi-insert-data-ke-database">&#x2022; Fungsi Insert Data ke Database</h4>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> doTheJob(workerIndex, counter <span class="hljs-keyword">int</span>, db *sql.DB, values []<span class="hljs-keyword">interface</span>{}) {
    <span class="hljs-keyword">for</span> {
        <span class="hljs-keyword">var</span> outerError error
        <span class="hljs-keyword">func</span>(outerError *error) {
            <span class="hljs-keyword">defer</span> <span class="hljs-keyword">func</span>() {
                <span class="hljs-keyword">if</span> err := <span class="hljs-built_in">recover</span>(); err != <span class="hljs-literal">nil</span> {
                    *outerError = fmt.Errorf(<span class="hljs-string">&quot;%v&quot;</span>, err)
                }
            }()

            conn, err := db.Conn(context.Background())
            query := fmt.Sprintf(<span class="hljs-string">&quot;INSERT INTO domain (%s) VALUES (%s)&quot;</span>,
                strings.Join(dataHeaders, <span class="hljs-string">&quot;,&quot;</span>),
                strings.Join(generateQuestionsMark(<span class="hljs-built_in">len</span>(dataHeaders)), <span class="hljs-string">&quot;,&quot;</span>),
            )

            _, err = conn.ExecContext(context.Background(), query, values...)
            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                log.Fatal(err.Error())
            }

            err = conn.Close()
            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                log.Fatal(err.Error())
            }
        }(&amp;outerError)
        <span class="hljs-keyword">if</span> outerError == <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">break</span>
        }
    }

    <span class="hljs-keyword">if</span> counter%<span class="hljs-number">100</span> == <span class="hljs-number">0</span> {
        log.Println(<span class="hljs-string">&quot;=&gt; worker&quot;</span>, workerIndex, <span class="hljs-string">&quot;inserted&quot;</span>, counter, <span class="hljs-string">&quot;data&quot;</span>)
    }
}

<span class="hljs-keyword">func</span> generateQuestionsMark(n <span class="hljs-keyword">int</span>) []<span class="hljs-keyword">string</span> {
    s := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">string</span>, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; n; i++ {
        s = <span class="hljs-built_in">append</span>(s, <span class="hljs-string">&quot;?&quot;</span>)
    }
    <span class="hljs-keyword">return</span> s
}
</code></pre>
<p>Pada kode di atas bisa dilihat bahwa kode insert dibungkus dalam IIFE dalam sebuah perulangan.</p>
<p>Kenapa butuh perulangan? keyword <code>for</code> di atas perannya sangat penting. Disini diterapkan mekanisme failover dimana ketika proses insert gagal akan di recover dan di-retry ulang.</p>
<p>Nah jadi ketika operasi insert di atas gagal, maka error tetap di tampilkan tapi kemudian diulang kembali insert data yang gagal tadi, hingga sukses.</p>
<p>O iya, mengenai kode untuk manajemen db connection poll mana ya? sepertinya tidak ada. Yups, memang tidak ada. As per Go official documentation untuk package <code>sql/database</code>, connection pool di manage oleh Go, kita engineer cukup panggil method <code>.Conn()</code> milik <code>*sql.DB</code> untuk mengambil pool item, yang pool item ini bisa berupa connection lama yang di reuse atau connection yang baru dibuat.</p>
<blockquote>
<p>Conn returns a single connection by either opening a new connection or returning an existing connection from the connection pool. Conn will block until either a connection is returned or ctx is canceled. Queries run on the same Conn will be run in the same database session.<br>Every Conn must be returned to the database pool after use by calling Conn.Close.</p>
</blockquote>
<p>Btw, di atas juga ada satu fungsi lagi, <code>generateQuestionsMark()</code>, gunanya untuk membantu pembentukan query insert data secara dinamis.</p>
<h4 id="fungsi-main">&#x2022; Fungsi Main</h4>
<p>Terakhir, panggil semua fungsi yang sudah dibuat pada main.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> main() {
    start := time.Now()

    db, err := openDbConnection()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Fatal(err.Error())
    }

    csvReader, csvFile, err := openCsvFile()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Fatal(err.Error())
    }
    <span class="hljs-keyword">defer</span> csvFile.Close()

    jobs := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> []<span class="hljs-keyword">interface</span>{}, <span class="hljs-number">0</span>)
    wg := <span class="hljs-built_in">new</span>(sync.WaitGroup)

    <span class="hljs-keyword">go</span> dispatchWorkers(db, jobs, wg)
    readCsvFilePerLineThenSendToWorker(csvReader, jobs, wg)

    wg.Wait()

    duration := time.Since(start)
    fmt.Println(<span class="hljs-string">&quot;done in&quot;</span>, <span class="hljs-keyword">int</span>(math.Ceil(duration.Seconds())), <span class="hljs-string">&quot;seconds&quot;</span>)
}
</code></pre>
<p>Di akhir fungsi main ditambahkan log untuk benchmark performa.</p>
<h2 id="d14-eksekusi-program">D.1.4. Eksekusi Program</h2>
<p>Ok, sekarang mari kita coba eksekusi program-nya.</p>
<p><img src="images/d-1-insert-1mil-csv-record-into-db-in-a-minute.png" alt="Preview"></p>
<p>Nah, bisa dilihat operasi insert selesai dalam waktu sekitar 1 menitan. Saya menggunakan laptop dengan spek berikut untuk run program:</p>
<ul>
<li>Core i7-8750H 2.20GHz (6 core, 12 logical prosesor)</li>
<li>RAM 16GB</li>
<li>SSD</li>
</ul>
<p>Kalau diperhatikan, hanya 25.8% utilisasi CPU, dan hanya 12MB saja resource RAM yang dibutuhkan. Di Task Manager CPU usage nya 100% karena My SQL server di lokal saya benar-benar bekerja keras untuk menjalankan operasi insert.</p>
<blockquote>
<p>Kecepatan aplikasi sangat tergantung dengan spesifikasi hardware laptop/server yang dipakai.</p>
</blockquote>
<p>Kalau dibandingkan dengan operasi insert data secara sekuensial, yang tanpa worker pool dan tanpa db connection pool, memakan waktu hingga <strong>20 MENIT!</strong>. Metode pada bab ini jauh lebih cepat.</p>
<p>Praktek pada bab ini sifatnya adalah POC, jadi sangat mungkin diperlukan penyesuaian untuk kasus nyata. Kode di atas sebenarnya juga masih bisa di optimize lagi dari banyak sisi.</p>
<hr>
<ul>
<li><a href="https://github.com/go-sql-driver/mysql" target="_blank">go-sql-driver/mysql</a>, by Go SQL Driver Team, Mozilla Public License 2.0</li>
</ul>
<hr>
<div class="source-code-link">
    <div class="source-code-link-message">Source code praktek pada bab ini tersedia di Github</div>
    <a href="https://github.com/novalagung/dasarpemrogramangolang-example/tree/master/chapter-D.1-insert-1mil-csv-record-into-db-in-a-minute" target="_blank">https://github.com/novalagung/dasarpemrogramangolang-example/.../chapter-D.1...</a>
</div>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover","level":"5.1.1","depth":2,"previous":{"title":"D. Studi Kasus","level":"5.1","depth":1,"ref":"","articles":[{"title":"D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover","level":"5.1.1","depth":2,"path":"D-1-insert-1mil-csv-record-into-db-in-a-minute.md","ref":"D-1-insert-1mil-csv-record-into-db-in-a-minute.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["ga","disqus","meta","sitemap"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"dasarpemrogramangolang"},"meta":{"content":"","data":[{"name":"google-site-verification","content":"UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE"},{"name":"og:image","content":"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"},{"name":"twitter:image","content":"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"}],"name":""},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sitemap":{"hostname":"https://dasarpemrogramangolang.novalagung.com/"},"ga":{"configuration":"auto","token":"UA-27602984-29"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","lunr":{"maxIndexSize":1000000000},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"D-1-insert-1mil-csv-record-into-db-in-a-minute.md","mtime":"2020-05-15T03:49:26.567Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-05-15T03:50:15.996Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    <div style="position: fixed; top: 10px; right: 30px; padding: 10px; background-color: rgba(255, 255, 255, 0.7);"><a class="github-button" href="https://github.com/novalagung/dasarpemrogramangolang" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star novalagung/dasarpemrogramangolang on GitHub">Star</a>&nbsp;<a class="github-button" href="https://github.com/novalagung" data-size="large" aria-label="Follow @novalagung on GitHub">Follow @novalagung</a><script async defer src="https://buttons.github.io/buttons.js"></script></div><a href="https://devops.novalagung.com/" target="_blank" class="book-news">Halo semua, Saya telah merilis ebook baru lo, tentang devops. Di ebook tersebut fokus tentang pembahasan banyak sekali stacks/teknologi devops, jadi tidak hanya membahas satu stack saja. Dan kabar baiknya tersedia dalam dua bahasa, Indonesia dan Inggris. Yuk mampir https://devops.novalagung.com/</a><div class="banner-container" onclick="this.style.display = 'none';"><div><a target="_blank" href="https://www.udemy.com/course/praktis-belajar-docker-dan-kubernetes-untuk-pemula/"><img src="/images/banner.png?v=2.2020.05.15.035038"></a></div></div><script>var bannerCounter = parseInt(localStorage.getItem("banner-counter")); if (isNaN(bannerCounter)) { bannerCounter = 0; } var bannerEl = document.querySelector('.banner-container'); if (bannerCounter % 5 === 0 && bannerEl) { bannerEl.style.display = 'block'; } localStorage.setItem("banner-counter", String(bannerCounter + 1));</script></body>
</html>

